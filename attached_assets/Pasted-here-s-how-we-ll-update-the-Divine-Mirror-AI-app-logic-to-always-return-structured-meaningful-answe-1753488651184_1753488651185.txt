hereâ€™s how weâ€™ll update the Divine Mirror AI app logic to always return structured, meaningful answers instead of just metadata fluff.

âœ… New App Logic for Answer Handling
Weâ€™ll break this into clear, developer-ready steps. You can copy/paste or hand to Replit directly.

ğŸ“1. Update the Main Search Function
Replace your current response logic with this streamlined structure:

python
Copy
Edit
def process_user_query(query):
    results = semantic_search(query)

    if not results or len(results) == 0:
        return {
            "status": "no_results",
            "response": "No direct match found. Try rephrasing your question."
        }

    top_result = results[0]
    
    return {
        "status": "success",
        "response": format_full_response(top_result, query)
    }
ğŸ§  2. Create the format_full_response() Function
This ensures every response includes:

ğŸ”¹ Direct quote from sacred text

ğŸ”¹ Simple AI summary of meaning

ğŸ”¹ Cross-tradition parallels (if found)

ğŸ”¹ Metadata (tradition, period, source)

python
Copy
Edit
def format_full_response(result, query):
    passage = result.get("text", "[No passage found]")
    metadata = result.get("metadata", {})

    response = f"""
ğŸ“– **Direct Quote**  
{passage.strip()}

ğŸ§  **Interpretation**  
{generate_ai_interpretation(passage, query)}

ğŸŒ **Tradition:** {metadata.get('tradition', 'Unknown')}  
ğŸ“œ **Period:** {metadata.get('period', 'Unknown')}  
ğŸ” **Source:** {metadata.get('source', 'N/A')}
"""

    # Optional: add cross-tradition echo if available
    parallels = get_cross_tradition_parallels(query)
    if parallels:
        response += f"\n\nğŸ”„ **Cross-Tradition Insight**\n{parallels}"

    return response
ğŸ” 3. Semantic Search Function (ChromaDB + Embeddings)
Make sure this is your underlying logic:

python
Copy
Edit
def semantic_search(query):
    docs = chroma_db.similarity_search_with_score(query, k=3)
    return [
        {
            "text": doc.page_content,
            "metadata": doc.metadata
        } for doc, score in docs if score < 0.6
    ]
ğŸ”® 4. Cross-Tradition Matching (Optional but Powerful)
Hereâ€™s a stub function you can later train with a comparative DB:

python
Copy
Edit
def get_cross_tradition_parallels(query):
    # Placeholder: could later use keyword matching or embeddings
    parallels = {
        "kingdom of god": "Gospel of Thomas, Saying 3: 'The Kingdom is inside you and outside you...'",
        "forgiveness": "Tao Te Ching 62: 'The sage does not blame; he forgives all.'",
    }
    for keyword, value in parallels.items():
        if keyword in query.lower():
            return value
    return None
ğŸ’¡ Bonus: Add Tone Adaptation for Final Output
If you want each answer to sound like the appâ€™s voice (Yeshua-style, calm and wise), we can tune the text-to-speech or embed a gentle narrative filter later.

âœ… Recap: What This Fix Gives You
âœ”ï¸ Direct quote from sacred texts
âœ”ï¸ Concise explanation in plain language
âœ”ï¸ Cross-tradition comparison (early Gnosticism, Taoism, etc.)
âœ”ï¸ Fully structured output â€” not just metadata
âœ”ï¸ No fallback to about-section fluff